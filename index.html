<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ¸ æ¯æ—¥ç¥ç¦ Blessing of the Day / Berkat Harian ğŸŒ¸</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;600;700&display=swap');
    
    body {
      margin: 0;
      font-family: "Noto Sans SC", "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1em;
    }
    .container {
      text-align: center;
      background: rgba(255, 255, 255, 0.95);
      padding: 2.5em 2em;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 520px;
      width: 100%;
    }
    h1 {
      font-size: 1.4em;
      margin-bottom: 1.5em;
      color: #333;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    
    .card {
      background: linear-gradient(135deg, #fff5f8 0%, #ffe8f0 100%);
      border-radius: 20px;
      padding: 2em 1.8em;
      margin-bottom: 1.5em;
      min-height: 280px;
      box-shadow: 0 10px 30px rgba(255, 105, 180, 0.2);
      transition: all 0.4s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      border: 3px solid #fff;
    }
    
    /* Decorative elements */
    .card::before {
      content: "âœ¨";
      position: absolute;
      top: 15px;
      left: 20px;
      font-size: 1.5em;
      opacity: 0.6;
    }
    
    .card::after {
      content: "ğŸŒ¸";
      position: absolute;
      bottom: 15px;
      right: 20px;
      font-size: 1.5em;
      opacity: 0.6;
    }
    
    .card.has-blessing {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 30%, #ffd8e8 100%);
      box-shadow: 0 10px 30px rgba(252, 182, 159, 0.3);
    }
    
    .card-cover {
      text-align: center;
      z-index: 1;
    }
    
    .card-cover .top-decoration {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5em;
      margin-bottom: 0.8em;
      font-size: 2em;
    }
    
    .card-cover .ornament {
      font-size: 3em;
      animation: float 3s ease-in-out infinite;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-12px); }
    }
    
    .card-cover h2 {
      font-size: 1.8em;
      background: linear-gradient(135deg, #c850c0 0%, #4158d0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0.5em 0;
      font-weight: 700;
      letter-spacing: 1px;
    }
    
    .card-cover p {
      font-size: 1em;
      color: #666;
      margin: 0.5em 0;
      line-height: 1.6;
      font-weight: 500;
    }
    
    .card-cover .hint {
      font-size: 0.9em;
      color: #999;
      margin-top: 1.2em;
      font-style: italic;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.3em;
    }
    
    .blessing-content {
      text-align: left;
      display: none;
      animation: fadeIn 0.6s ease;
      z-index: 1;
      width: 100%;
      max-width: 100%;
    }
    
    .blessing-content.show {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .blessing-content .text-block {
      background: rgba(255, 255, 255, 0.7);
      padding: 0.8em 1em;
      border-radius: 12px;
      margin: 0.6em 0;
      border-left: 4px solid #ff6b9d;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .blessing-content .chinese {
      font-size: 1.25em;
      font-weight: 700;
      color: #2c3e50;
      line-height: 1.7;
      margin-bottom: 0;
    }
    
    .blessing-content .english {
      font-style: italic;
      color: #555;
      font-size: 0.95em;
      line-height: 1.6;
      margin: 0.4em 0 0 0;
    }
    
    .blessing-content .malay {
      color: #555;
      font-size: 0.95em;
      line-height: 1.6;
      margin: 0.4em 0 0 0;
    }
    
    .blessing-content .reference {
      font-size: 0.85em;
      color: #888;
      margin-top: 1em;
      padding: 0.6em 1em;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
      border: 2px dashed #ffb6c1;
    }
    
    .blessing-content .footer-text {
      text-align: center;
      margin-top: 1.2em;
      font-size: 1em;
      color: #c850c0;
      font-weight: 600;
    }
    
    .button-group {
      display: flex;
      flex-direction: column;
      gap: 0.8em;
    }
    
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      color: white;
      padding: 14px 24px;
      font-size: 1em;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      letter-spacing: 0.5px;
    }
    
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
    }
    
    button:active {
      transform: translateY(-1px);
    }
    
    #draw-btn {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
      font-size: 1.1em;
      padding: 16px 24px;
    }
    
    #draw-btn:hover {
      box-shadow: 0 8px 25px rgba(245, 87, 108, 0.6);
    }
    
    @media (max-width: 600px) {
      .container {
        padding: 1.8em 1.2em;
      }
      h1 {
        font-size: 1.15em;
      }
      .card {
        padding: 1.8em 1.3em;
        min-height: 260px;
      }
      .card-cover h2 {
        font-size: 1.5em;
      }
      .blessing-content .chinese {
        font-size: 1.1em;
      }
      button {
        font-size: 0.95em;
        padding: 12px 20px;
      }
      #draw-btn {
        font-size: 1em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸŒ¸ æ¯æ—¥ç¥ç¦ | Blessing of the Day | Berkat Harian ğŸŒ¸</h1>
    
    <div id="blessing-card" class="card">
      <!-- Cover (shown by default) -->
      <div class="card-cover" id="card-cover">
        <div class="top-decoration">
          <span>ğŸ’</span>
          <span>ğŸŒº</span>
          <span>â˜€ï¸</span>
        </div>
        <div class="ornament">âœ¨</div>
        <h2>å¤©çˆ¶çˆ±ä½ </h2>
        <p><strong>God Loves You</strong></p>
        <p><strong>Tuhan Mengasihi Anda</strong></p>
        <div class="hint">
          <span>ğŸ‘‡</span>
          <span>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–ç¥ç¦</span>
          <span>ğŸ‘‡</span>
        </div>
      </div>
      
      <!-- Blessing content (hidden initially) -->
      <div class="blessing-content" id="blessing-content">
        <div class="text-block">
          <p class="chinese">ç‚¹å‡»"æŠ½å–ç¥ç¦"å¼€å§‹</p>
          <p class="english">Click "Get Blessing" to start</p>
          <p class="malay">Klik "Dapatkan Berkat" untuk mula</p>
        </div>
      </div>
    </div>
    
    <div class="button-group">
      <button id="draw-btn">âœ¨ æŠ½å–ç¥ç¦ | Get Blessing | Dapatkan Berkat âœ¨</button>
      <button id="share-btn">ğŸ’Œ åˆ†äº«ç¥ç¦ | Share Blessing | Kongsi Berkat</button>
      <button id="music-btn">ğŸµ æš‚åœéŸ³ä¹ | Pause Music | Hentikan Muzik</button>
    </div>
  </div>
  
  <audio id="bgm" autoplay loop muted playsinline>
    <source src="gentle-piano.mp3" type="audio/mpeg">
  </audio>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const drawBtn = document.getElementById('draw-btn');
      const shareBtn = document.getElementById('share-btn');
      const musicBtn = document.getElementById('music-btn');
      const card = document.getElementById('blessing-card');
      const cardCover = document.getElementById('card-cover');
      const blessingContent = document.getElementById('blessing-content');
      const bgm = document.getElementById('bgm');

      let blessings = [];
      let currentBlessing = null;
      let audioPlaying = true;
      let lastIndex = -1;
      let usedIndices = [];

      const FALLBACK = [
        {
          "zh": "è€¶å’Œåæ˜¯æˆ‘çš„ç‰§è€…ï¼Œæˆ‘å¿…ä¸è‡´ç¼ºä¹ã€‚",
          "en": "The Lord is my shepherd; I shall not want.",
          "ms": "Tuhan ialah gembalaku, aku tidak kekurangan apa-apa.",
          "ref": "è¯—ç¯‡ Psalm 23:1"
        },
        {
          "zh": "ä½ è¦ä¸“å¿ƒä»°èµ–è€¶å’Œåï¼Œä¸å¯å€šé è‡ªå·±çš„èªæ˜ã€‚",
          "en": "Trust in the Lord with all your heart and lean not on your own understanding.",
          "ms": "Percayalah kepada Tuhan dengan segenap hatimu dan janganlah bersandar kepada pengertianmu sendiri.",
          "ref": "ç®´è¨€ Proverbs 3:5"
        },
        {
          "zh": "å‡¡ä½ ä»¬æ‰€åšçš„ï¼Œéƒ½è¦å‡­çˆ±å¿ƒè€Œåšã€‚",
          "en": "Do everything in love.",
          "ms": "Lakukan segala sesuatu dengan kasih.",
          "ref": "å“¥æ—å¤šå‰ä¹¦ 1 Corinthians 16:14"
        }
      ];

      function getSecureRandom(max) {
        const array = new Uint32Array(1);
        crypto.getRandomValues(array);
        return array[0] % max;
      }

      function getRandomBlessing() {
        if (blessings.length === 0) return null;
        
        if (usedIndices.length >= Math.floor(blessings.length * 0.7)) {
          usedIndices = [];
        }
        
        let availableIndices = [];
        for (let i = 0; i < blessings.length; i++) {
          if (!usedIndices.includes(i) && i !== lastIndex) {
            availableIndices.push(i);
          }
        }
        
        if (availableIndices.length === 0) {
          availableIndices = Array.from({length: blessings.length}, (_, i) => i);
        }
        
        const randomPosition = getSecureRandom(availableIndices.length);
        const selectedIndex = availableIndices[randomPosition];
        
        lastIndex = selectedIndex;
        usedIndices.push(selectedIndex);
        
        return blessings[selectedIndex];
      }

      function renderBlessing(item) {
        if (!item) return;
        currentBlessing = item;
        
        blessingContent.innerHTML = `
          <div class="text-block">
            <p class="chinese">${item.zh}</p>
            <p class="english">${item.en}</p>
            <p class="malay">${item.ms}</p>
          </div>
          <div class="reference">ğŸ“– ${item.ref || ''}</div>
          <div class="footer-text">ğŸ’ æ„¿ä¸»ç¥ç¦ä½  ğŸ’</div>
        `;
        
        cardCover.style.display = 'none';
        blessingContent.classList.add('show');
        card.classList.add('has-blessing');
      }

      function drawRandom() {
        if (!Array.isArray(blessings) || blessings.length === 0) {
          alert('ç¥ç¦è¯­è½½å…¥ä¸­ï¼Œè¯·ç¨åå†è¯• / Loading blessings, please try again');
          return;
        }
        
        const blessing = getRandomBlessing();
        renderBlessing(blessing);
      }

      function shareCurrent() {
        if (!currentBlessing) {
          alert('è¯·å…ˆæŠ½å–ç¥ç¦ / Please draw a blessing first / Sila dapatkan berkat dahulu');
          return;
        }
        const text = `ğŸŒ¸ æ¯æ—¥ç¥ç¦ Daily Blessing ğŸŒ¸\n\n${currentBlessing.zh}\n\n${currentBlessing.en}\n\n${currentBlessing.ms}\n\nğŸ“– ${currentBlessing.ref || ''}\n\nğŸ’ æ„¿ä¸»ç¥ç¦ä½  ğŸ’`;
        const url = window.location.href;

        if (navigator.share) {
          navigator.share({
            title: 'æ¯æ—¥ç¥ç¦ | Blessing of the Day',
            text,
            url
          }).catch(()=>{});
        } else {
          const encoded = encodeURIComponent(`${text}\n\n${url}`);
          const wa = `https://wa.me/?text=${encoded}`;
          window.open(wa, '_blank');
        }
      }

      function updateMusicBtn() {
        if (!musicBtn) return;
        musicBtn.textContent = audioPlaying
          ? 'ğŸµ æš‚åœéŸ³ä¹ | Pause Music | Hentikan Muzik'
          : 'ğŸµ æ’­æ”¾éŸ³ä¹ | Play Music | Main Muzik';
      }

      function tryAutoPlay() {
        if (!bgm) return;
        bgm.volume = 0.28;
        bgm.play()
          .then(() => { audioPlaying = true; updateMusicBtn(); })
          .catch(() => { audioPlaying = false; updateMusicBtn(); });
      }

      if (drawBtn) drawBtn.addEventListener('click', drawRandom);
      if (shareBtn) shareBtn.addEventListener('click', shareCurrent);
      if (musicBtn && bgm) {
        musicBtn.addEventListener('click', () => {
          if (audioPlaying) {
            bgm.pause();
            audioPlaying = false;
          } else {
            bgm.play().catch(()=>{});
            audioPlaying = true;
          }
          updateMusicBtn();
        });
      }

      fetch('blessing.json')
        .then(resp => {
          if (!resp.ok) throw new Error('load failed');
          return resp.json();
        })
        .then(data => {
          if (!Array.isArray(data) || data.length === 0) throw new Error('invalid json');
          blessings = data;
        })
        .catch(err => {
          console.warn('Failed to load blessings.json â€” using fallback. Error:', err);
          blessings = FALLBACK.slice();
        })
        .finally(() => {
          tryAutoPlay();
          updateMusicBtn();
        });
    });
  </script>
</body>
</html>

